# Managerç«¯ éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å®æ–½æ€»è§ˆ

å·²å®ŒæˆManagerç«¯çš„å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€åç«¯APIå’Œå‰ç«¯é›†æˆã€‚æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å·²ä»å‰ç«¯JavaScriptç§»è‡³åç«¯SQLå’ŒPHPã€‚

---

## ğŸ¯ å·²åˆ›å»ºçš„æ–‡ä»¶

### æ•°æ®åº“æ–‡ä»¶ (database/)

1. **manager_tables.sql** - æ–°å»ºè¡¨
   - `replenishment_requests` - è¡¥è´§ç”³è¯·è¡¨ï¼ˆåŒ…å«å·¥ä½œæµçŠ¶æ€ç®¡ç†ï¼‰

2. **manager_views.sql** - 15ä¸ªè§†å›¾
   - å‘˜å·¥ç®¡ç†ï¼š`vw_manager_employees`, `vw_manager_employee_performance`, `vw_manager_staff_by_store`
   - åº“å­˜ç®¡ç†ï¼š`vw_manager_inventory_overview`, `vw_manager_inventory_by_store`, `vw_manager_inventory_by_sku`, `vw_manager_replenishment_requests`
   - é‡‡è´­ç®¡ç†ï¼š`vw_manager_purchases`, `vw_manager_suppliers`
   - è®¢å•é”€å”®ï¼š`vw_manager_orders_summary`, `vw_manager_sales_by_store`, `vw_manager_sales_by_category`
   - ç»Ÿè®¡åˆ†æï¼š`vw_manager_payment_analysis`, `vw_manager_bestsellers`, `vw_manager_store_performance`

3. **manager_procedures.sql** - 12ä¸ªå­˜å‚¨è¿‡ç¨‹
   - å‘˜å·¥ç®¡ç†ï¼š`sp_manager_add_employee`, `sp_manager_update_employee`, `sp_manager_delete_employee`
   - ä¹¦ç±å®šä»·ï¼š`sp_manager_add_book`, `sp_manager_update_pricing`
   - åº“å­˜è°ƒæ‹¨ï¼š`sp_manager_transfer_inventory`
   - è¡¥è´§ç”³è¯·ï¼š`sp_manager_create_replenishment_request`, `sp_manager_approve_request`, `sp_manager_reject_request`
   - é‡‡è´­ç®¡ç†ï¼š`sp_manager_create_purchase`, `sp_manager_add_supplier`
   - é€šçŸ¥ç®¡ç†ï¼š`sp_manager_send_notification`

4. **triggers.sql** - 3ä¸ªæ ¸å¿ƒè§¦å‘å™¨
   - `trg_order_payment_deduct_inventory` - è®¢å•æ”¯ä»˜æ—¶è‡ªåŠ¨æ‰£å‡åº“å­˜ï¼ˆFIFOï¼‰
   - `trg_order_payment_add_points` - è®¢å•æ”¯ä»˜æ—¶è‡ªåŠ¨å¢åŠ ç§¯åˆ†
   - `trg_update_member_tier` - è‡ªåŠ¨æ›´æ–°ä¼šå‘˜ç­‰çº§

### PHP APIæ–‡ä»¶ (api/manager/)

10ä¸ªå®Œæ•´çš„RESTful APIæ–‡ä»¶ï¼š

1. **stores.php** - åº—é“ºç®¡ç†API
2. **employees.php** - å‘˜å·¥ç®¡ç†API (CRUD)
3. **books.php** - ä¹¦ç±å’Œå®šä»·ç®¡ç†API
4. **users.php** - ç”¨æˆ·ç®¡ç†API
5. **notifications.php** - é€šçŸ¥ç®¡ç†API
6. **inventory.php** - åº“å­˜ç®¡ç†API
7. **replenishment.php** - è¡¥è´§ç”³è¯·API
8. **purchases.php** - é‡‡è´­ç®¡ç†API
9. **suppliers.php** - ä¾›åº”å•†ç®¡ç†API
10. **reports.php** - ç»Ÿè®¡æŠ¥è¡¨API

### JavaScriptæ–‡ä»¶ (scripts/)

1. **manager-api.js** - APIé…ç½®å’Œå°è£…å‡½æ•°
2. **manager-api-integration.js** - å‰ç«¯é›†æˆï¼ˆè¦†ç›–mockå‡½æ•°ï¼‰

### ä¿®æ”¹çš„æ–‡ä»¶

- **pages/manager.html** - æ·»åŠ äº†scriptæ ‡ç­¾å¼•ç”¨æ–°çš„APIæ–‡ä»¶

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬1æ­¥ï¼šéƒ¨ç½²æ•°æ®åº“

åœ¨phpMyAdminä¸­æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹SQLæ–‡ä»¶ï¼š

```bash
1. database/manager_tables.sql      # åˆ›å»ºè¡¥è´§ç”³è¯·è¡¨
2. database/manager_views.sql       # åˆ›å»º15ä¸ªè§†å›¾
3. database/manager_procedures.sql  # åˆ›å»º12ä¸ªå­˜å‚¨è¿‡ç¨‹
4. database/triggers.sql            # åˆ›å»º3ä¸ªè§¦å‘å™¨
```

**éªŒè¯æ–¹æ³•**ï¼š
```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
SHOW TABLES LIKE 'replenishment_requests';

-- æ£€æŸ¥è§†å›¾
SHOW FULL TABLES WHERE TABLE_TYPE = 'VIEW' AND Tables_in_book_store LIKE 'vw_manager%';

-- æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹
SHOW PROCEDURE STATUS WHERE Db = 'book_store' AND Name LIKE 'sp_manager%';

-- æ£€æŸ¥è§¦å‘å™¨
SHOW TRIGGERS WHERE `Trigger` LIKE 'trg_%';
```

### ç¬¬2æ­¥ï¼šéªŒè¯PHP API

ç¡®ä¿æ‰€æœ‰APIæ–‡ä»¶éƒ½å·²æ­£ç¡®éƒ¨ç½²åˆ° `api/manager/` ç›®å½•ã€‚

**æµ‹è¯•æ–¹æ³•**ï¼ˆåœ¨æµè§ˆå™¨ä¸­ï¼‰ï¼š
```
http://localhost/DiamondPageStore/api/manager/stores.php?action=list
http://localhost/DiamondPageStore/api/manager/employees.php?action=list
http://localhost/DiamondPageStore/api/manager/reports.php?action=overview
```

åº”è¯¥è¿”å›JSONæ ¼å¼çš„æ•°æ®ï¼Œæ ¼å¼ä¸ºï¼š
```json
{
  "success": true,
  "message": "...",
  "data": [...],
  "count": 10
}
```

### ç¬¬3æ­¥ï¼šéªŒè¯å‰ç«¯é›†æˆ

1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—® `http://localhost/DiamondPageStore/pages/manager.html`
3. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
4. æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºï¼š
   ```
   Manager API functions loaded successfully
   Manager API Integration loaded successfully
   ```

5. æµ‹è¯•å„ä¸ªæ¨¡å—ï¼š
   - **æ¦‚è§ˆé¡µé¢**ï¼šæŸ¥çœ‹ç»Ÿè®¡æ•°æ®ã€å›¾è¡¨
   - **åº“å­˜ç®¡ç†**ï¼šæŸ¥çœ‹åº“å­˜ã€è¡¥è´§ç”³è¯·
   - **å‘˜å·¥ç®¡ç†**ï¼šæŸ¥çœ‹å‘˜å·¥åˆ—è¡¨
   - **ç”¨æˆ·ç®¡ç†**ï¼šæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
   - **é€šçŸ¥ç®¡ç†**ï¼šæŸ¥çœ‹å’Œåˆ›å»ºé€šçŸ¥

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] **å‘˜å·¥ç®¡ç†**
  - [ ] æŸ¥çœ‹å‘˜å·¥åˆ—è¡¨
  - [ ] æ·»åŠ æ–°å‘˜å·¥
  - [ ] ç¼–è¾‘å‘˜å·¥ä¿¡æ¯
  - [ ] åˆ é™¤å‘˜å·¥
  - [ ] æœç´¢å‘˜å·¥

- [ ] **åº“å­˜ç®¡ç†**
  - [ ] æŸ¥çœ‹åº“å­˜æ€»è§ˆ
  - [ ] æŒ‰åº—é“ºæŸ¥çœ‹åº“å­˜
  - [ ] æŒ‰SKUæŸ¥çœ‹åº“å­˜
  - [ ] åº“å­˜è°ƒæ‹¨

- [ ] **è¡¥è´§ç”³è¯·**
  - [ ] æŸ¥çœ‹è¡¥è´§ç”³è¯·åˆ—è¡¨
  - [ ] ç­›é€‰ç”³è¯·ï¼ˆæŒ‰çŠ¶æ€ã€åº—é“ºã€ç´§æ€¥ç¨‹åº¦ï¼‰
  - [ ] æ‰¹å‡†ç”³è¯·
  - [ ] æ‹’ç»ç”³è¯·
  - [ ] æ ‡è®°å®Œæˆ

- [ ] **ä¹¦ç±å®šä»·ç®¡ç†**
  - [ ] æŸ¥çœ‹ä¹¦ç±å®šä»·åˆ—è¡¨
  - [ ] æ·»åŠ æ–°ä¹¦ç±
  - [ ] æ›´æ–°å®šä»·

- [ ] **ç”¨æˆ·ç®¡ç†**
  - [ ] æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
  - [ ] åˆ‡æ¢ç”¨æˆ·çŠ¶æ€
  - [ ] åˆ é™¤ç”¨æˆ·
  - [ ] æœç´¢ç”¨æˆ·

- [ ] **é€šçŸ¥ç®¡ç†**
  - [ ] æŸ¥çœ‹é€šçŸ¥åˆ—è¡¨
  - [ ] åˆ›å»ºé€šçŸ¥
  - [ ] ç¼–è¾‘é€šçŸ¥
  - [ ] åˆ é™¤é€šçŸ¥

- [ ] **ç»Ÿè®¡æŠ¥è¡¨**
  - [ ] æ¦‚è§ˆç»Ÿè®¡
  - [ ] æŒ‰åº—é“ºé”€å”®ç»Ÿè®¡
  - [ ] æŒ‰åˆ†ç±»é”€å”®ç»Ÿè®¡
  - [ ] æ”¯ä»˜æ–¹å¼åˆ†æ
  - [ ] çƒ­é”€ä¹¦ç±æ’è¡Œ

### è§¦å‘å™¨æµ‹è¯•

- [ ] **åº“å­˜æ‰£å‡è§¦å‘å™¨**
  1. åˆ›å»ºè®¢å•å¹¶æ·»åŠ å•†å“
  2. å°†è®¢å•çŠ¶æ€æ”¹ä¸º 'paid'
  3. æ£€æŸ¥ `inventory_batches` è¡¨ï¼Œåº“å­˜åº”è¯¥æŒ‰FIFOåŸåˆ™è‡ªåŠ¨æ‰£å‡

- [ ] **ç§¯åˆ†å¢åŠ è§¦å‘å™¨**
  1. å°†è®¢å•çŠ¶æ€æ”¹ä¸º 'paid'
  2. æ£€æŸ¥ `members` è¡¨ï¼Œç§¯åˆ†åº”è¯¥å¢åŠ 
  3. æ£€æŸ¥ `point_ledgers` è¡¨ï¼Œåº”è¯¥æœ‰æ–°è®°å½•

- [ ] **ä¼šå‘˜ç­‰çº§æ›´æ–°è§¦å‘å™¨**
  1. ä¼šå‘˜ç§¯åˆ†å˜åŒ–å
  2. æ£€æŸ¥ `members` è¡¨ï¼Œç­‰çº§åº”è¯¥æ ¹æ®ç´¯è®¡æ¶ˆè´¹è‡ªåŠ¨æ›´æ–°

---

## ğŸ“Š æ¶æ„è¯´æ˜

### æ•°æ®æµå‘

```
å‰ç«¯ (manager.html)
    â†“
JavaScript APIå°è£… (manager-api.js)
    â†“
PHP API (api/manager/*.php)
    â†“
å­˜å‚¨è¿‡ç¨‹ / è§†å›¾ (database/*.sql)
    â†“
MySQLæ•°æ®åº“
```

### å…³é”®è®¾è®¡æ¨¡å¼

1. **è§†å›¾æ¨¡å¼**ï¼šæ‰€æœ‰æŸ¥è¯¢æ“ä½œé€šè¿‡è§†å›¾ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å’Œä¸€è‡´æ€§
2. **å­˜å‚¨è¿‡ç¨‹æ¨¡å¼**ï¼šæ‰€æœ‰å†™æ“ä½œé€šè¿‡å­˜å‚¨è¿‡ç¨‹ï¼ŒåŒ…å«äº‹åŠ¡å’Œé”™è¯¯å¤„ç†
3. **è§¦å‘å™¨æ¨¡å¼**ï¼šå…³é”®ä¸šåŠ¡é€»è¾‘è‡ªåŠ¨æ‰§è¡Œï¼ˆåº“å­˜ã€ç§¯åˆ†ã€ç­‰çº§ï¼‰
4. **å‡½æ•°è¦†ç›–æ¨¡å¼**ï¼šå‰ç«¯é€šè¿‡manager-api-integration.jsè¦†ç›–åŸæœ‰mockå‡½æ•°

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šAPIè¿”å›404

**åŸå› **ï¼šPHPæ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®æˆ–Apacheæœªå¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨ `api/manager/` ç›®å½•
2. ç¡®ä¿ApacheæœåŠ¡æ­£åœ¨è¿è¡Œ
3. æ£€æŸ¥URLè·¯å¾„æ˜¯å¦æ­£ç¡®

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**åŸå› **ï¼šæ•°æ®åº“é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `config/database.php` ä¸­çš„æ•°æ®åº“é…ç½®
2. ç¡®è®¤ä½¿ç”¨çš„æ˜¯ `DatabaseLocal` ç±»
3. éªŒè¯MySQLæœåŠ¡æ­£åœ¨è¿è¡Œ

### é—®é¢˜3ï¼šå­˜å‚¨è¿‡ç¨‹è°ƒç”¨å¤±è´¥

**åŸå› **ï¼šå­˜å‚¨è¿‡ç¨‹æœªæ­£ç¡®åˆ›å»ºæˆ–å‚æ•°é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹æ˜¯å¦å­˜åœ¨ï¼š`SHOW PROCEDURE STATUS WHERE Name = 'sp_manager_xxx'`
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
3. ç¡®è®¤å‚æ•°ç±»å‹å’Œæ•°é‡æ­£ç¡®

### é—®é¢˜4ï¼šå‰ç«¯æ˜¾ç¤ºmockæ•°æ®

**åŸå› **ï¼šAPIé›†æˆæ–‡ä»¶æœªåŠ è½½æˆ–åŠ è½½é¡ºåºé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯
2. ç¡®è®¤scriptæ ‡ç­¾é¡ºåºï¼šmanager-api.js â†’ manager-data.js â†’ manager.js â†’ manager-api-integration.js
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### é—®é¢˜5ï¼šè§¦å‘å™¨ä¸æ‰§è¡Œ

**åŸå› **ï¼šè§¦å‘å™¨åˆ›å»ºå¤±è´¥æˆ–æ¡ä»¶ä¸æ»¡è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥è§¦å‘å™¨æ˜¯å¦å­˜åœ¨ï¼š`SHOW TRIGGERS`
2. ç¡®è®¤è®¢å•çŠ¶æ€ç¡®å®ä»é'paid'å˜ä¸º'paid'
3. æŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—

---

## âœ… éªŒè¯æˆåŠŸæ ‡å‡†

1. âœ… æ•°æ®åº“ï¼š1ä¸ªè¡¨ã€15ä¸ªè§†å›¾ã€12ä¸ªå­˜å‚¨è¿‡ç¨‹ã€3ä¸ªè§¦å‘å™¨å…¨éƒ¨åˆ›å»ºæˆåŠŸ
2. âœ… APIï¼š10ä¸ªPHPæ–‡ä»¶å…¨éƒ¨å¯è®¿é—®ï¼Œè¿”å›æ­£ç¡®çš„JSONæ•°æ®
3. âœ… å‰ç«¯ï¼šæ‰€æœ‰6ä¸ªæ¨¡å—åŠ è½½çœŸå®æ•°æ®ï¼Œæ— mockæ•°æ®
4. âœ… è§¦å‘å™¨ï¼šè®¢å•æ”¯ä»˜æ—¶è‡ªåŠ¨æ‰£å‡åº“å­˜ã€å¢åŠ ç§¯åˆ†ã€æ›´æ–°ç­‰çº§
5. âœ… æ€§èƒ½ï¼šç»Ÿè®¡æŸ¥è¯¢å“åº”æ—¶é—´ < 2ç§’

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### ç¬¦åˆè€å¸ˆè¦æ±‚

âœ… **ä¸šåŠ¡é€»è¾‘åœ¨åç«¯**ï¼šæ‰€æœ‰è®¡ç®—ã€ç­›é€‰ã€èšåˆéƒ½åœ¨SQL/PHPä¸­å®Œæˆ
âœ… **ä½¿ç”¨è§†å›¾**ï¼š15ä¸ªè§†å›¾å°è£…å¤æ‚æŸ¥è¯¢
âœ… **ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹**ï¼š12ä¸ªå­˜å‚¨è¿‡ç¨‹å¤„ç†æ‰€æœ‰å†™æ“ä½œï¼ŒåŒ…å«äº‹åŠ¡ç®¡ç†
âœ… **ä½¿ç”¨è§¦å‘å™¨**ï¼š3ä¸ªè§¦å‘å™¨å®ç°è‡ªåŠ¨åŒ–ä¸šåŠ¡é€»è¾‘
âœ… **å‰ç«¯åªè´Ÿè´£æ¸²æŸ“**ï¼šJavaScriptåªè°ƒç”¨APIå’Œæ˜¾ç¤ºUIï¼Œæ— ä¸šåŠ¡é€»è¾‘

### SQLé«˜çº§ç‰¹æ€§

- âœ… äº‹åŠ¡ç®¡ç† (START TRANSACTION, COMMIT, ROLLBACK)
- âœ… é”™è¯¯å¤„ç† (EXIT HANDLER FOR SQLEXCEPTION)
- âœ… FIFOåº“å­˜æ‰£å‡ (ORDER BY received_date)
- âœ… JSONå¤„ç† (JSON_LENGTH, JSON_EXTRACT, JSON_ARRAYAGG)
- âœ… èšåˆæŸ¥è¯¢ (GROUP_CONCAT, COALESCE, å­æŸ¥è¯¢)
- âœ… æ¸¸æ ‡å¾ªç¯ (CURSOR, LOOP)
- âœ… è§¦å‘å™¨ (AFTER UPDATE, AFTER INSERT)

---

## ğŸ“ é¡¹ç›®æ€»ç»“

æœ¬æ¬¡å®æ–½å®Œæˆäº†ï¼š

1. **æ•°æ®åº“å±‚**ï¼š4ä¸ªSQLæ–‡ä»¶ï¼Œ30ä¸ªæ•°æ®åº“å¯¹è±¡
2. **åç«¯å±‚**ï¼š10ä¸ªPHP APIæ–‡ä»¶ï¼Œæ¯ä¸ª3-7ä¸ªaction
3. **å‰ç«¯å±‚**ï¼š2ä¸ªJavaScriptæ–‡ä»¶ï¼Œå®Œå…¨æ›¿æ¢mockæ•°æ®
4. **é›†æˆå±‚**ï¼šä¿®æ”¹HTMLï¼Œå®ç°æ— ç¼é›†æˆ

**æ€»è®¡**ï¼š
- SQLæ–‡ä»¶ï¼š4ä¸ª
- PHPæ–‡ä»¶ï¼š10ä¸ª
- JavaScriptæ–‡ä»¶ï¼š2ä¸ª
- ä¿®æ”¹æ–‡ä»¶ï¼š1ä¸ª
- ä»£ç è¡Œæ•°ï¼šçº¦5000+è¡Œ

**ç¬¦åˆè¦æ±‚**ï¼š
- âœ… ä¸»è¦ä¸šåŠ¡é€»è¾‘åœ¨åç«¯SQL/PHP
- âœ… ä½¿ç”¨è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨
- âœ… å‰ç«¯JavaScriptåªè´Ÿè´£APIè°ƒç”¨å’ŒUIæ¸²æŸ“
- âœ… å®Œå…¨ç§»é™¤æ¨¡æ‹Ÿæ•°æ®ä¾èµ–

---

## ğŸ“ åç»­æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

1. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. PHPé”™è¯¯æ—¥å¿— (é€šå¸¸åœ¨XAMPP/logs/error.log)
3. MySQLé”™è¯¯æ—¥å¿—
4. æ•°æ®åº“è¿æ¥é…ç½®

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„Managerç«¯å°†å®Œå…¨ä½¿ç”¨çœŸå®æ•°æ®åº“æ•°æ®ï¼Œæ»¡è¶³è¯¾ç¨‹è¦æ±‚ï¼
