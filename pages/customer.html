<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diamond Page Store</title>

  <!-- 1. 引入本地脚本 (注意顺序) -->
  <script src="../scripts/tailwind.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../styles/global.css">

  <!-- 在各页面 head 标签最顶部插入 -->
  <script>
    // [文件名]: customer.html 
    (function () {
      const token = localStorage.getItem('auth_token');
      const role = localStorage.getItem('user_role');
      const currentPage = window.location.pathname.split('/').pop();

      // 1. 基础检查：无 Token 直接回退
      if (!token) {
        window.location.href = 'login.html';
        return;
      }

      // 2. 角色越权检查修复
      const roleRouteMap = {
        'customer': 'customer.html',
        'staff': 'staff.html',
        'manager': 'manager.html',
        'finance': 'finance.html'
      };

      // 如果当前角色不是 customer，且试图访问 customer.html
      // 说明是角色残留，强制清空并去登录
      if (role !== 'customer') {
        console.warn("Role mismatch. Clearing session...");
        localStorage.removeItem('user_role');
        localStorage.removeItem('auth_token');
        sessionStorage.removeItem('currentPage'); // 清除残留的页面ID
        window.location.href = 'login.html';
      }
    })();
  </script>
  <!-- 2. 引入布局生成器 -->
  <script src="../scripts/layout.js"></script>

  <!-- Tailwind 自定义配置 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto { content-visibility: auto; }
      .sidebar-item { @apply flex items-center gap-3 px-4 py-3 text-white transition-all duration-200 cursor-pointer; }
      .sidebar-item-public-hover { @apply hover:bg-brown-dark/70; }
      .sidebar-item-personal-hover { @apply hover:bg-brown-dark/90; }
      .sidebar-item-active { @apply bg-brown-dark border-l-4 border-white; }
      .header-icon { @apply w-10 h-10 flex items-center justify-center rounded-full hover:bg-brown-light/20 transition-colors cursor-pointer; }
      .page-transition { @apply transition-all duration-300; }
    }
  </style>

</head>

<body class="bg-brown-cream min-h-screen flex overflow-x-hidden font-serif">
  <!-- 移动端按钮 -->
  <button id="sidebarToggle" class="fixed left-4 top-4 z-50 md:hidden bg-brown text-white p-2 rounded-md shadow-lg">
    <i class="fa fa-bars"></i>
  </button>

  <!-- 布局占位符 -->
  <div id="layout-sidebar"></div>

  <!-- 右侧主体区域 -->
  <div class="flex-1 flex flex-col">

    <!-- 布局占位符 -->
    <div id="layout-header"></div>

    <!-- 具体的页面内容 -->
    <main class="flex-1 p-6 md:p-10">
      <!-- 1. 主页 -->
      <div class="page-content" id="home-page">
        <!-- 加载中状态 -->
        <div class="page-loading hidden flex justify-center items-center h-40">
          <i class="fa fa-spinner fa-spin text-brown text-2xl"></i>
        </div>
        <!-- 顶部轮播 -->
        <div class="relative h-64 md:h-80 mb-10 rounded-xl overflow-hidden shadow-md">
          <img src="https://picsum.photos/id/24/1200/400" alt="Membership Promotion" class="w-full h-full object-cover">
          <div class="absolute inset-0 bg-brown-dark/50 flex items-center">
            <div class="px-8 text-white">
              <h2 class="text-3xl font-bold mb-2">Members Exclusive: 20% Off</h2>
              <p class="mb-4">From now until October 31, Gold Members and above enjoy 20% off all books</p>
              <button
                class="bg-brown-light text-brown-dark px-6 py-2 rounded-md font-medium hover:bg-white transition-colors">
                Learn More
              </button>
            </div>
          </div>
        </div>

        <!-- 书店简介 -->
        <section class="mb-12 bg-white p-6 rounded-lg shadow-sm">
          <h2 class="text-2xl font-bold text-brown-dark mb-4">About Diamond Page Store</h2>
          <p class="text-gray-700 leading-relaxed">
            Welcome to Diamond Page Store! Our Headquarters ensures unified pricing and curated selections, while our
            local branches deliver exceptional daily sales, customer service, and membership management. This dual-layer
            structure guarantees you a high-quality, seamless, and personalized reading experience every time.
          </p>
        </section>
      </div>

      <!-- 2. 书籍查询页面 -->
      <div class="page-content hidden page-transition" id="search-page">
        <div class="page-loading hidden flex justify-center items-center h-40">
          <i class="fa fa-spinner fa-spin text-brown text-2xl"></i>
        </div>
        <div class="max-w-2xl mx-auto mb-10">
          <div class="relative">
            <input type="text" placeholder="Enter keywords to search..."
              class="w-full py-3 px-5 pr-12 rounded-full border-2 border-brown-light focus:border-brown focus:outline-none shadow-sm"
              id="search-input">
            <button class="absolute right-4 top-1/2 -translate-y-1/2 text-brown" id="do-search-btn">
              <i class="fa fa-search text-xl"></i>
            </button>
          </div>
        </div>

        <!-- 搜索筛选区 -->
        <div class="bg-white p-4 rounded-lg shadow-sm mb-6 border border-brown-light/20">
          <div class="flex flex-wrap gap-6">
            <!-- 任务 4：价格筛选 -->
            <div class="flex items-center">
              <label class="text-sm font-bold text-brown-dark mr-2">Price Range:</label>
              <select
                class="border border-brown-light rounded px-3 py-1.5 text-sm focus:ring-1 focus:ring-brown outline-none"
                id="price-filter">
                <option value="all">All Prices</option>
                <option value="0-20">¥0 - ¥20</option>
                <option value="20-50">¥20 - ¥50</option>
                <option value="50+">Above ¥50</option>
              </select>
            </div>
            <!-- 任务 4：语言筛选 -->
            <div class="flex items-center">
              <label class="text-sm font-bold text-brown-dark mr-2">Language:</label>
              <select
                class="border border-brown-light rounded px-3 py-1.5 text-sm focus:ring-1 focus:ring-brown outline-none"
                id="language-filter">
                <option value="all">All Languages</option>
                <option value="English">English</option>
                <option value="Chinese">Chinese</option>
                <option value="French">French</option>
                <option value="Janpenese">Janpenese</option>
                <option value="Russian">Russian</option>
                <option value="Korean">Korean</option>
                <option value="Italian">Italian</option>
              </select>
            </div>
            <!-- 任务 5：增强排序功能 -->
            <div class="flex items-center">
              <label class="text-sm font-bold text-brown-dark mr-2">Sort By:</label>
              <select
                class="border border-brown-light rounded px-3 py-1.5 text-sm focus:ring-1 focus:ring-brown outline-none"
                id="sort-filter">
                <option value="default">Default</option>
                <option value="popular">Popular Recommendations</option>
                <option value="price-asc">Price: Low to High</option>
                <option value="price-desc">Price: High to Low</option>
              </select>
            </div>
          </div>
        </div>


        <!-- 搜索结果区域 -->
        <section>
          <h2 class="text-2xl font-bold text-brown-dark mb-6 border-b border-brown-light pb-2">
            Search Results <span class="text-base text-gray-600 font-normal" id="search-keyword">(Please enter
              keywords)</span>
          </h2>
          <div class="flex flex-wrap gap-2 mb-6">
            <span class="text-sm text-gray-600">Popular Searches:</span>
            <span
              class="text-sm bg-brown-light/30 text-brown px-3 py-1 rounded-full cursor-pointer hover:bg-brown-light/50 transition-colors"
              data-hot="The Three-Body Problem">The Three-Body Problem</span>
            <span
              class="text-sm bg-brown-light/30 text-brown px-3 py-1 rounded-full cursor-pointer hover:bg-brown-light/50 transition-colors"
              data-hot="Sapiens: A Brief History of Humankind">Sapiens</span>
            <span
              class="text-sm bg-brown-light/30 text-brown px-3 py-1 rounded-full cursor-pointer hover:bg-brown-light/50 transition-colors"
              data-hot="Yu Hua">Yu Hua</span>
          </div>
          <div id="search-results" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6"></div>
          <div id="no-results" class="hidden text-center py-10 text-gray-600">
            <i class="fa fa-search-minus text-4xl mb-3 text-brown-light"></i>
            <p>No related books found. Please try other keywords.</p>
          </div>
        </section>
      </div>

      <!-- 3. 各类书籍页面 -->
      <div class="page-content hidden page-transition" id="categories-page">
        <div class="page-loading hidden flex justify-center items-center h-40">
          <i class="fa fa-spinner fa-spin text-brown text-2xl"></i>
        </div>
        <div class="fixed inset-0 -z-10 opacity-20 overflow-hidden">
          <img src="https://picsum.photos/id/42/1920/1080" alt="Bookstore Background"
            class="w-full h-full object-cover">
        </div>

        <h2 class="text-2xl font-bold text-brown-dark mb-6 border-b border-brown-light pb-2">Book Categories</h2>

        <!-- 【任务 2 更新】分类标签导航栏 -->
        <div class="space-y-6 mb-10 bg-white/50 p-6 rounded-xl backdrop-blur-sm">
          <!-- 全部 -->
          <div class="flex items-center gap-4">
            <span class="text-sm font-bold text-brown-dark min-w-[80px]">General</span>
            <div class="flex flex-wrap gap-2">
              <button class="category-btn bg-brown text-white px-4 py-1.5 rounded-full text-xs transition-all shadow-sm"
                data-category="all">All Books</button>
            </div>
          </div>

          <!-- Fiction -->
          <div class="flex items-start gap-4">
            <span class="text-sm font-bold text-brown-dark min-w-[80px] mt-1">Fiction</span>
            <div class="flex flex-wrap gap-2">
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Novel">Novel</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Historical Novel">Historical Novel</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Psychological Novel">Psychological Novel</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Philosophical Novel">Philosophical Novel</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Epic Poetry">Epic Poetry</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Poetry">Poetry</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Drama">Drama</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Short Story Collection">Short Story Collection</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Essay">Essay/Diary</button>
            </div>
          </div>

          <!-- Non-Fiction -->
          <div class="flex items-start gap-4">
            <span class="text-sm font-bold text-brown-dark min-w-[80px] mt-1">Non-Fiction</span>
            <div class="flex flex-wrap gap-2">
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Political Treatise">Political Treatise</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Philosophy">Philosophy</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Science">Science</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Psychology">Psychology</button>
            </div>
          </div>

          <!-- Genre -->
          <div class="flex items-start gap-4">
            <span class="text-sm font-bold text-brown-dark min-w-[80px] mt-1">Genre</span>
            <div class="flex flex-wrap gap-2">
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Adventure">Adventure</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Romance">Romance</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Satire">Satire</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Bildungsroman">Bildungsroman</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Modernist">Modernist</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Gothic">Gothic</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Science Fiction">Science Fiction</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Fantasy">Fantasy</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Mystery">Mystery/Detective</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Myth">Myth/Folktale</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Children">Children's Literature</button>
              <button
                class="category-btn bg-white text-brown border border-brown px-4 py-1.5 rounded-full text-xs hover:bg-brown-light/20 transition-all"
                data-category="Novella">Novella</button>
            </div>
          </div>
        </div>

        <!-- 分类书籍列表 -->
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6 relative z-10" id="category-books"></div>
        <!-- 在分类筛选逻辑 div 之后插入 -->
        <div class="flex justify-end mb-6">
          <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-lg border border-brown-light/30 shadow-sm">
            <label class="text-sm font-bold text-brown-dark"><i class="fa fa-sort-amount-desc"></i> Sort By:</label>
            <select id="category-sort-filter"
              class="text-sm border-none focus:ring-0 cursor-pointer bg-transparent text-gray-600">
              <option value="default">Default Match</option>
              <option value="fav-desc">Most Favorites (High to Low)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- 4. 购物车页面 -->
      <div class="page-content hidden page-transition bg-white rounded-xl p-6 shadow-sm" id="cart-page">
        <div class="page-loading hidden flex justify-center items-center h-40">
          <i class="fa fa-spinner fa-spin text-brown text-2xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-brown-dark mb-6 border-b border-brown-light pb-2">My Shopping Cart</h2>
        <div id="cart-empty" class="text-center py-10">
          <i class="fa fa-shopping-cart text-5xl mb-4 text-brown-light"></i>
          <p class="text-gray-600 mb-6">Your cart is empty~</p>
          <button id="cart-go-home"
            class="bg-brown text-white px-6 py-2 rounded-md hover:bg-brown-dark transition-colors">
            Browse Homepage
          </button>
        </div>
        <div id="cart-list" class="hidden space-y-4"></div>
        <div id="cart-footer"
          class="hidden mt-6 pt-4 border-t border-brown-light/30 flex flex-col sm:flex-row justify-between items-center gap-4">
          <div class="flex items-center gap-6">
            <button id="clear-cart"
              class="text-brown hover:text-brown-dark transition-colors flex items-center gap-1"><i
                class="fa fa-trash-o"></i> Clear Cart</button>
            <div class="text-lg text-brown-dark">Total: <span id="cart-total" class="font-bold text-brown">¥0.00</span>
            </div>
          </div>
          <button id="proceed-checkout"
            class="bg-brown text-white px-6 py-2 rounded-md hover:bg-brown-dark transition-colors w-full sm:w-auto shadow-md active:scale-95">
            Proceed to Checkout
          </button>
        </div>
      </div>

      <!-- 5. 订单页面 -->
      <div class="page-content hidden page-transition bg-white rounded-xl p-6 shadow-sm" id="orders-page">
        <div class="page-loading hidden flex justify-center items-center h-40">
          <i class="fa fa-spinner fa-spin text-brown text-2xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-brown-dark mb-6 border-b border-brown-light pb-2">My Orders</h2>
        <div class="flex flex-wrap gap-3 mb-6">
          <button
            class="order-status-btn bg-brown text-white px-4 py-2 rounded-full text-sm hover:bg-brown-dark transition-colors"
            data-status="all">All Orders</button>
          <button
            class="order-status-btn bg-white text-brown border border-brown px-4 py-2 rounded-full text-sm hover:bg-brown-light/20 transition-colors"
            data-status="created">Pending Payment</button>
          <button
            class="order-status-btn bg-white text-brown border border-brown px-4 py-2 rounded-full text-sm hover:bg-brown-light/20 transition-colors"
            data-status="paid">Paid</button>
          <button
            class="order-status-btn bg-white text-brown border border-brown px-4 py-2 rounded-full text-sm hover:bg-brown-light/20 transition-colors"
            data-status="cancelled">Cancelled</button>
        </div>
        <div id="orders-list" class="space-y-6 pb-20">
          <!-- 动态渲染订单卡片 -->
        </div>

        <!-- 任务 3.2 新增：订单页底部操作栏 -->
        <div id="orders-footer"
          class="hidden mt-8 pt-6 border-t border-brown-light/30 flex flex-col md:flex-row justify-between items-center gap-4 bg-brown-cream/30 p-4 rounded-lg">
          <div class="flex items-center gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" id="select-all-orders" class="w-5 h-5 accent-brown">
              <span class="text-sm font-bold text-brown-dark">Select All</span>
            </label>
            <div class="text-sm text-gray-600">
              Selected: <span id="selected-orders-count" class="font-bold text-brown">0</span>
            </div>
          </div>
          <div class="flex items-center gap-6">
            <div class="text-right">
              <p class="text-xs text-gray-500 uppercase">Total Amount</p>
              <p id="combined-total-price" class="text-xl font-bold text-brown">¥0.00</p>
            </div>
            <button id="merge-payment-btn" disabled
              class="bg-brown text-white px-8 py-3 rounded-xl font-bold hover:bg-brown-dark disabled:bg-gray-300 disabled:cursor-not-allowed transition-all shadow-md active:scale-95">
              Combine Payment
            </button>
          </div>
        </div>
      </div>

      <!-- 6. 收藏页面 -->
      <div class="page-content hidden page-transition bg-white rounded-xl p-6 shadow-sm" id="favorites-page">
        <div class="page-loading hidden flex justify-center items-center h-40">
          <i class="fa fa-spinner fa-spin text-brown text-2xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-brown-dark mb-6 border-b border-brown-light pb-2">My Favorites</h2>
        <div id="favorites-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
          <p class="text-gray-600 col-span-full text-center py-10">No favorite books</p>
        </div>
      </div>

      <!-- 7. 会员中心 -->
      <div class="page-content hidden page-transition bg-white rounded-xl p-6 shadow-sm" id="member-page">
        <div class="page-loading hidden flex justify-center items-center h-40">
          <i class="fa fa-spinner fa-spin text-brown text-2xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-brown-dark mb-6 border-b border-brown-light pb-2">Membership Center</h2>

        <div
          class="bg-gradient-to-r from-brown-dark to-brown rounded-2xl p-8 mb-8 text-white shadow-lg relative overflow-hidden">
          <!-- 背景装饰图标 -->
          <i class="fa fa-diamond absolute -right-4 -bottom-4 text-white/10 text-9xl rotate-12"></i>

          <div class="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-8">
            <div>
              <div class="flex items-center gap-3 mb-2">
                <span id="member-level-badge"
                  class="bg-white/20 px-3 py-1 rounded-full text-xs font-bold tracking-widest uppercase">Loading...</span>
              </div>
              <h3 id="display-user-name" class="text-3xl font-serif font-bold">Customer</h3>
              <p class="text-white/70 mt-2 text-sm">Total Spent: <span id="member-total-spent"
                  class="font-bold text-white">¥0.00</span></p>
            </div>
            <div class="flex items-center gap-8 bg-black/10 p-6 rounded-xl backdrop-blur-sm">
              <div class="text-center">
                <p id="member-points" class="font-bold text-3xl">0</p>
                <p class="text-[10px] uppercase tracking-widest text-white/60">Available Points</p>
              </div>
              <div class="w-px h-10 bg-white/20"></div>
              <div class="text-center">
                <p id="member-discount-text" class="font-bold text-3xl">0%</p>
                <p class="text-[10px] uppercase tracking-widest text-white/60">Current Discount</p>
              </div>
            </div>
          </div>
        </div>

        <h3 class="text-xl font-bold text-brown-dark mb-4">Privileges & Progress</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8" id="member-tier-cards">
          <!-- 动态生成的等级卡片将插入此处 -->
        </div>
      </div>

      <!-- 个人信息编辑弹窗 -->
      <div id="profile-modal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 transform transition-all">
          <div class="flex justify-between items-center mb-6 border-b border-brown-light/30 pb-3">
            <h3 class="text-xl font-bold text-brown-dark">Edit Profile</h3>
            <button class="close-profile text-gray-400 hover:text-brown"><i class="fa fa-times text-xl"></i></button>
          </div>
          <form id="profile-form" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
              <input type="text" id="profile-username"
                class="w-full border border-brown-light/50 rounded-lg px-4 py-2 focus:ring-2 focus:ring-brown outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Email / Contact</label>
              <input type="email" id="profile-email"
                class="w-full border border-brown-light/50 rounded-lg px-4 py-2 focus:ring-2 focus:ring-brown outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
              <input type="password" id="profile-password" placeholder="Leave blank to keep current"
                class="w-full border border-brown-light/50 rounded-lg px-4 py-2 focus:ring-2 focus:ring-brown outline-none">
            </div>
            <div class="pt-4 flex gap-3">
              <button type="button"
                class="close-profile flex-1 py-2 border border-brown text-brown rounded-lg hover:bg-brown-light/10 transition-colors">Cancel</button>
              <button type="submit"
                class="flex-1 py-2 bg-brown text-white rounded-lg hover:bg-brown-dark transition-colors shadow-md">Save
                Changes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- 历史公告弹窗 -->
      <div id="announcement-modal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col p-6">
          <div class="flex justify-between items-center mb-6 border-b border-brown-light/30 pb-3">
            <h3 class="text-xl font-bold text-brown-dark"><i class="fa fa-bullhorn mr-2"></i>Historical Announcements
            </h3>
            <button id="close-announcement" class="text-gray-400 hover:text-brown"><i
                class="fa fa-times text-xl"></i></button>
          </div>
          <div id="announcement-list" class="flex-1 overflow-y-auto space-y-4 pr-2">
            <!-- 动态加载公告 -->
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-brown-dark text-white py-8 px-6">
      <div class="container mx-auto text-center">
        <p class="mb-2">© 2024 Diamond Page Store</p>
        <p class="text-sm text-brown-light/80">Make reading a way of life</p>
      </div>
    </footer>
  </div>

  <script src="../scripts/common.js"></script>
  <script>initLayout('customer', 'home');</script>
  <div id="detail-overlay" class="fixed inset-0 bg-black/50 z-50 hidden transition-opacity duration-300 opacity-0">
  </div>

  <div id="book-detail-modal"
    class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-4xl max-h-[90vh] overflow-auto bg-white rounded-xl shadow-2xl p-6 md:p-8 hidden transition-all duration-300 transform scale-95 opacity-0">
    <button id="close-detail"
      class="absolute top-4 right-4 text-gray-500 hover:text-brown-dark transition-colors text-2xl"><i
        class="fa fa-times-circle"></i></button>
    <div class="pb-4 border-b border-brown-light/30 mb-6">
      <div class="flex justify-between items-start">
        <div>
          <h2 id="detail-book-title" class="text-3xl md:text-4xl font-serif font-bold text-brown-dark">...</h2>
          <p id="detail-book-author" class="text-xl text-gray-600 mt-1 italic">Loading...</p>
        </div>
        <div class="text-center bg-brown-cream px-4 py-2 rounded-lg border border-brown-light/20">
          <i class="fa fa-heart text-red-500 text-xl"></i>
          <p id="detail-fav-count" class="text-xs font-bold text-brown-dark mt-1">0</p>
          <p class="text-[10px] text-gray-500 uppercase">Favorites</p>
        </div>
      </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <div class="lg:col-span-5 space-y-6">
        <div class="bg-brown-cream/50 p-5 rounded-xl border border-brown-light/30 space-y-4">
          <h3 class="text-sm font-bold text-brown-dark uppercase tracking-widest border-b border-brown-light/30 pb-2">
            Store & Availability</h3>
          <div class="space-y-3">
            <p class="flex justify-between items-center"><span class="text-sm text-gray-600 font-medium">Store
                Location:</span><span id="detail-store-name" class="text-sm font-bold text-brown-dark">Main
                Headquarters</span></p>
            <p class="flex justify-between items-center"><span class="text-sm text-gray-600 font-medium">Binding
                Format:</span><span id="detail-binding" class="text-sm font-bold text-brown-dark">Hardcover</span></p>
            <p class="flex justify-between items-center">
              <span class="text-sm text-gray-600 font-medium">Stock Status:</span>
              <span id="detail-book-stock" class="text-sm font-bold text-gray-400">Checking...</span>
            </p>
          </div>
        </div>
        <div class="flex flex-col gap-4">
          <div class="flex items-baseline gap-2">
            <span id="detail-book-price" class="text-4xl font-extrabold text-red-600">¥0.00</span>
            <span class="text-xs text-gray-400">Regular Price</span>
          </div>
          <div class="flex gap-3">
            <button id="add-to-cart"
              class="flex-1 bg-brown text-white py-4 rounded-xl font-bold hover:bg-brown-dark transition-all shadow-md active:scale-95 flex items-center justify-center gap-2"><i
                class="fa fa-shopping-cart"></i> Add to Cart</button>
            <button id="add-to-favorite"
              class="w-14 h-14 border-2 border-brown text-brown rounded-xl hover:bg-brown-light/20 transition-all flex items-center justify-center"><i
                class="fa fa-heart-o text-xl"></i></button>
          </div>
        </div>
      </div>
      <div class="lg:col-span-7 space-y-6">
        <div>
          <h3 class="text-lg font-bold text-brown-dark mb-3 flex items-center gap-2"><i class="fa fa-file-text-o"></i>
            Introduction</h3>
          <p id="detail-book-desc"
            class="text-gray-700 leading-relaxed text-base italic bg-gray-50 p-4 rounded-lg border-l-4 border-brown-light">
            Loading book introduction...
          </p>
        </div>
        <div class="grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
          <p class="text-sm"><span class="font-medium text-brown-dark">Category:</span> <span id="detail-book-category"
              class="text-gray-600">Fiction</span></p>
          <p class="text-sm"><span class="font-medium text-brown-dark">Publisher:</span> <span
              id="detail-book-publisher" class="text-gray-600">Publisher Co.</span></p>
          <p class="text-sm"><span class="font-medium text-brown-dark">Language:</span> <span id="detail-book-language"
              class="text-gray-600">English</span></p>
          <p class="text-sm col-span-2"><span class="font-medium text-brown-dark">ISBN:</span> <span
              id="detail-book-isbn" class="text-gray-600 text-xs">978-3-16-148410-0</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- 任务 3.3：支付弹窗 -->
  <div id="payment-modal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl w-full max-w-md overflow-hidden shadow-2xl transform transition-all">
      <div class="p-6 border-b border-gray-100 flex justify-between items-center">
        <h3 class="text-xl font-bold text-brown-dark">Complete Payment</h3>
        <button class="close-payment text-gray-400 hover:text-gray-600"><i class="fa fa-times text-xl"></i></button>
      </div>
      <div class="p-6 space-y-6">
        <div>
          <label class="text-sm text-gray-500 block mb-2">Order(s) Summary</label>
          <div id="payment-summary-list" class="max-h-32 overflow-y-auto space-y-2 border-y py-3 border-gray-50">
            <!-- 动态显示支付列表 -->
          </div>
        </div>
        <div class="flex justify-between items-center">
          <span class="font-medium">Total Amount</span>
          <span id="payment-modal-total" class="text-2xl font-bold text-red-600">¥0.00</span>
        </div>
        <div class="space-y-3">
          <label class="text-sm font-bold text-brown-dark block">Select Payment Method</label>
          <div class="grid grid-cols-2 gap-3">
            <label
              class="border-2 border-brown rounded-xl p-3 flex flex-col items-center gap-2 cursor-pointer bg-brown/5">
              <input type="radio" name="pay-method" value="credit" checked class="hidden">
              <i class="fa fa-credit-card text-2xl text-brown"></i>
              <span class="text-xs font-bold">Credit Card</span>
            </label>
            <label
              class="border-2 border-gray-100 rounded-xl p-3 flex flex-col items-center gap-2 cursor-pointer hover:border-brown/50">
              <input type="radio" name="pay-method" value="paypal" class="hidden">
              <i class="fa fa-paypal text-2xl text-gray-400"></i>
              <span class="text-xs font-bold text-gray-500">PayPal</span>
            </label>
          </div>
        </div>
        <button id="confirm-payment-btn"
          class="w-full bg-brown text-white py-4 rounded-xl font-bold text-lg hover:bg-brown-dark transition-all flex items-center justify-center gap-3 shadow-lg">
          <span id="pay-btn-text">Confirm Payment</span>
          <i id="pay-spinner" class="fa fa-spinner fa-spin hidden"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- API相关脚本 -->
  <script src="../scripts/customer-api.js"></script>
  <script src="../scripts/book-detail.js"></script>
  <script src="../scripts/customer.js"></script>
  <!-- API集成脚本（覆盖customer.js中的函数） -->
  <!-- script src="../scripts/customer-api-integration.js"></！script-->
</body>

</html>