<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diamond Page Store - Staff Dashboard</title>

    <!-- 1. 外部资源 -->
    <script src="../scripts/tailwind.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="../styles/global.css">

    <!-- 前端路由守卫, 判断登录者是否有对应权限 -->
    <!-- 代码写在head里是防止加载过慢导致外部人员越权查看 -->
    <script>
        (function () {
            const token = localStorage.getItem('auth_token');
            const role = localStorage.getItem('user_role');
            const currentPage = window.location.pathname.split('/').pop();

            // 1. 基础检查：无 Token 直接回退
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // 2. 角色越权检查 (可选增强)
            const roleRouteMap = {
                'customer': 'customer.html',
                'staff': 'staff.html',
                'manager': 'manager.html',
                'finance': 'finance.html'
            };

            // 如果当前文件名不是该角色应属的页面，且不是 login.html，则强制纠正
            if (role !== 'staff') {
                console.warn("Role mismatch. Clearing session...");
                localStorage.removeItem('user_role');
                localStorage.removeItem('auth_token');
                sessionStorage.removeItem('currentPage'); // 清除残留的页面ID
                window.location.href = 'login.html';
            }
        })();
    </script>

    <!-- 2. 自定义样式补充 -->
    <link rel="stylesheet" href="../styles/staff.css">

</head>

<body class="bg-gray-50 font-sans text-dark h-screen flex overflow-hidden">

    <!-- 1. 侧边栏容器 (layout.js 填充) -->
    <div id="layout-sidebar" class="w-64 flex-shrink-0 transition-all duration-300 overflow-hidden relative z-40"></div>

    <!-- 2. 右侧主体区域 -->
    <div class="flex-1 flex flex-col h-full min-w-0 overflow-hidden relative transition-all duration-300">

        <!-- 头部容器 (layout.js 填充) -->
        <div id="layout-header" class="flex-shrink-0"></div>

        <!-- 具体的页面内容 -->
        <main class="flex-1 overflow-y-auto p-4 lg:p-6" id="main-content">

            <!-- A. Dashboard Page -->
            <div id="dashboard-page" class="page-content">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-2xl font-bold">Branch Dashboard</h1>
                    </div>

                    <div id="current-date" class="text-gray-600"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="card">
                        <p class="text-sm text-gray-500 mb-1">Total Inventory</p>
                        <p class="text-2xl font-bold" id="total-books">0</p>
                        <p class="text-sm text-green-600 mt-1 flex items-center">
                            <i class="fa fa-refresh mr-1"></i> Updated just now
                        </p>
                    </div>

                    <div class="card">
                        <p class="text-sm text-gray-500 mb-1">Low Stock Items</p>
                        <p class="text-2xl font-bold text-red-600" id="low-stock-books">0</p>
                          <p class="text-sm text-red-600 mt-1 flex items-center">
                              <i class="fa fa-exclamation-triangle mr-1"></i> Low stock threshold: ≤ 5
                          </p>
                    </div>

                    <div class="card">
                        <p class="text-sm text-gray-500 mb-1">Total Orders</p>
                        <p class="text-2xl font-bold" id="total-orders-count">0</p>
                        <p class="text-sm text-blue-600 mt-1 flex items-center">
                            <i class="fa fa-shopping-bag mr-1"></i> Branch lifetime total
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Recent Orders (Branch Only)</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Order ID</th>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Status</th>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Order Time</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-orders-list" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Low Stock Items </h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Title</th>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Category</th>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Action</th>
                                    </tr>
                                </thead>
                                <tbody id="low-stock-list" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- B. Inventory Management Page -->
            <div id="inventory-page" class="page-content hidden">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
                    <div>
                        <h1 class="text-2xl font-bold">Inventory Management</h1>
                        <p class="text-gray-500">Manage all books in your branch inventory</p>
                    </div>
                    <button class="btn-primary" id="add-book-btn">
                        <i class="fa fa-plus mr-2"></i>Add New Book
                    </button>
                </div>

                <div class="card mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Search Inventory</label>
                            <div class="relative">
                                <input type="text" id="inventory-search" class="form-input pl-10"
                                    placeholder="Title, Author, ISBN...">
                                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="category-filter" class="form-input">
                                <option value="">All Categories</option>
                                <option value="Novel">Novel</option>
                                <option value="Adventure">Adventure</option>
                                <option value="Mystery">Mystery</option>
                                <option value="Detective">Detective</option>
                                <option value="Science">Science</option>
                                <option value="Psychological Novel">Psychological Novel</option>
                                <option value="Modernist">Modernist</option>
                                <option value="Historical Novel">Historical Novel</option>
                                <option value="Children's Literature">Children's Literature</option>
                                <option value="Political Treatise">Political Treatise</option>
                                <option value="Epic Poetry">Epic Poetry</option>
                                <option value="Short Story Collection">Short Story Collection</option>
                                <option value="Romance">Romance</option>
                                <option value="Novella">Novella</option>
                                <option value="Science Fiction">Science Fiction</option>
                                <option value="Philosophy">Philosophy</option>
                                <option value="Essay">Essay</option>
                                <option value="Diary">Diary</option>
                                <option value="Drama">Drama</option>
                                <option value="Fantasy">Fantasy</option>
                                <option value="Gothic">Gothic</option>
                                <option value="Satire">Satire</option>
                                <option value="Poetry">Poetry</option>
                                <option value="Philosophical Novel">Philosophical Novel</option>
                                <option value="Bildungsroman">Bildungsroman</option>
                                <option value="Psychology">Psychology</option>
                                <option value="Myth">Myth</option>
                                <option value="Folktale">Folktale</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Stock Level</label>
                            <select id="stock-filter" class="form-input">
                                <option value="">All Levels</option>
                                <option value="low">Low Stock (0-5)</option>
                                <option value="medium">Medium Stock (6-20)</option>
                                <option value="high">High Stock (21+)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sort By</label>
                            <select id="sort-filter" class="form-input">
                                <option value="title-asc">Title (A-Z)</option>
                                <option value="title-desc">Title (Z-A)</option>
                                <option value="stock-asc">Stock (Low to High)</option>
                                <option value="stock-desc">Stock (High to Low)</option>
                                <option value="price-asc">Price (Low to High)</option>
                                <option value="price-desc">Price (High to Low)</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="hide-zero-stock"
                                class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                            <label for="hide-zero-stock" class="text-sm text-gray-700">Hide items with zero
                                stock</label>
                        </div>
                        <div class="flex gap-2">
                            <button id="filter-inventory" class="btn-primary">Apply Filters</button>
                            <button id="reset-inventory" class="btn-secondary">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Inventory List</h3>
                        <p class="text-sm text-gray-500">Total: <span id="total-inventory-count">0</span> items</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Title</th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Author</th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        ISBN</th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Category</th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Price</th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Stock</th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Status</th>
                                    <th
                                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-list" class="bg-white divide-y divide-gray-200"></tbody>
                        </table>
                    </div>

                    <!-- 原有分页代码（182-205行）整体替换为： -->
                    <div id="inventory-pagination-controls"></div>
                </div>
            </div>

            <!-- C. Order Management Page -->
            <div id="orders-page" class="page-content hidden">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
                    <div>
                        <h1 class="text-2xl font-bold">Order Management</h1>
                        <p class="text-gray-500">Manage and track all customer orders</p>
                    </div>
                </div>

                <div class="card mb-6">
                    <h3 class="text-lg font-semibold mb-4">Filter Criteria</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                            <div class="flex items-center gap-2">
                                <input type="date" id="order-date-from" class="form-input">
                                <span class="text-gray-500">to</span>
                                <input type="date" id="order-date-to" class="form-input">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Order Status</label>
                            <select id="order-status-filter" class="form-input">
                                <option value="">All Statuses</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Search Order</label>
                            <div class="relative">
                                <input type="text" id="order-search" placeholder="Order ID, Customer Name..." class="form-input pl-10">
                                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button id="apply-order-filters" class="btn-primary bg-brown-dark hover:bg-brown-dark/90 border-none px-8">
                            <i class="fa fa-search mr-2"></i>Search
                        </button>
                        <button id="reset-order-filters" class="btn-secondary px-8">
                            <i class="fa fa-refresh mr-2"></i>Reset
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Order ID</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Customer</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Date</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Items</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Total</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Status</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Actions</th>
                                </tr>
                            </thead>
                            <tbody id="orders-list" class="bg-white divide-y divide-gray-200"></tbody>
                        </table>
                        <div id="orders-pagination-controls"></div>
                    </div>
                </div>
            </div>

            <!-- D. Stock Requests Page -->
            <div id="stock-request-page" class="page-content hidden">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
                    <h1 class="text-2xl font-bold">Stock Requests</h1>
                    <button class="btn-primary" id="new-request-btn">
                        <i class="fa fa-plus mr-2"></i>New Stock Request
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Pending Requests</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Request ID</th>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Actions</th>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Items</th>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-lg">
                                            Expected Delivery</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-requests-list" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Previous Requests</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Request ID</th>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Actions</th>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Items</th>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Status</th>
                                        <th
                                            class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-lg">
                                            Delivery Date</th>
                                    </tr>
                                </thead>
                                <tbody id="previous-requests-list" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modal for Book Details/Editing (放在主体之外) -->
    <div id="book-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold" id="modal-title">Add New Book</h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="book-form">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="book-batch">Batch Number
                            *</label>
                        <input type="text" id="book-batch" class="form-input" placeholder="e.g. BATCH-2023-001"
                            required>
                    </div>
                    <input type="hidden" id="book-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-title">Book Title
                                *</label>
                            <input type="text" id="book-title" class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-isbn">ISBN *</label>
                            <input type="text" id="book-isbn" class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-category">Category
                                *</label>
                            <select id="book-category" class="form-input" required>
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-price">Price *</label>
                            <input type="number" id="book-price" class="form-input" min="0" step="0.01" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-language">Language *</label>
                            <input type="text" id="book-language" class="form-input" placeholder="English" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-binding">Binding *</label>
                            <select id="book-binding" class="form-input" required>
                                <option value="">Select Binding</option>
                                <option value="Hardcover">Hardcover</option>
                                <option value="Paperback">Paperback</option>
                                <option value="Mass Market Paperback">Mass Market Paperback</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-stock">Initial Stock Quantity
                                *</label>
                            <input type="number" id="book-stock" class="form-input" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" for="book-publisher">Publisher *</label>
                            <input type="text" id="book-publisher" class="form-input" placeholder="Publisher Name" required>
                        </div>
                    </div>

                    <!-- Author Information -->
                    <div class="border-t border-gray-100 pt-4 mt-4">
                        <h4 class="text-sm font-semibold text-gray-600 mb-3">Author Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                                <input type="text" id="book-author-first" class="form-input" placeholder="Mark" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                                <input type="text" id="book-author-last" class="form-input" placeholder="Twain" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                                <input type="text" id="book-author-country" class="form-input" placeholder="USA">
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="book-intro">Introduction</label>
                        <textarea id="book-intro" class="form-input" rows="3" placeholder="Brief introduction of the book..."></textarea>
                    </div>
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" id="cancel-book" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Save Book</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="order-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold">Order Details <span id="detail-order-id"
                        class="text-gray-400 ml-2"></span></h3>
                <button onclick="closeOrderModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <div class="mb-6">
                    <h4 class="text-sm font-semibold text-gray-500 uppercase mb-2">Customer Information</h4>
                    <p id="detail-customer-name" class="text-gray-900 font-medium"></p>
                </div>
                <div class="mb-6">
                    <h4 class="text-sm font-semibold text-gray-500 uppercase mb-2">Book List</h4>
                    <table class="min-w-full divide-y divide-gray-200 border rounded-lg overflow-hidden">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Book Title
                                </th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ISBN</th>
                                <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Qty</th>
                                <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Subtotal
                                </th>
                            </tr>
                        </thead>
                        <tbody id="order-items-table" class="divide-y divide-gray-200">
                            <!-- Dynamic items -->
                        </tbody>
                        <tfoot class="bg-gray-50">
                            <tr>
                                <td colspan="2" class="px-4 py-2 text-right font-bold text-gray-900">Total</td>
                                <td id="detail-order-total" class="px-4 py-2 text-right font-bold text-primary"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="mb-2">
                    <label class="block text-sm font-semibold text-gray-500 uppercase mb-2">Order Status</label>
                    <div class="flex items-center gap-3">
                        <div id="detail-order-status-badge" class="inline-block px-3 py-1 rounded-full text-sm font-medium">
                        </div>
                        <select id="detail-order-status-select" class="form-input text-sm py-1 w-40">
                            <!-- Dynamic statuses -->
                        </select>
                        <button onclick="updateOrderStatus()" class="btn-primary py-1 px-3 text-xs">Update</button>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end gap-3">
                <button onclick="closeOrderModal()" class="btn-secondary text-sm">Close</button>
            </div>
        </div>
    </div>

    <!-- Stock Request Modal -->
    <div id="stock-request-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold">New Stock Request</h3>
                <button onclick="closeRequestModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <form id="stock-request-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Requested Items</label>
                        <table class="min-w-full border rounded-lg overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase">Book
                                        Title</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase w-32">
                                        ISBN</th>
                                    <th class="px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase w-24">SKU
                                    </th>
                                    <th class="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase w-20">
                                        Qty</th>
                                    <th class="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase w-10">
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="request-items-body" class="divide-y divide-gray-200">
                                <!-- 动态行模板 -->
                                <tr>
                                    <td class="p-1">
                                        <input type="text" class="form-input text-xs item-title"
                                            placeholder="Search book..." list="book-suggestions" required>
                                    </td>
                                    <td class="p-1"><input type="text" class="form-input text-xs item-isbn"
                                            placeholder="ISBN" readonly></td>
                                    <td class="p-1"><input type="text" class="form-input text-xs item-sku"
                                            placeholder="SKU" readonly></td>
                                    <td class="p-1"><input type="number" class="form-input text-xs text-center item-qty"
                                            min="1" value="10" required></td>
                                    <td class="p-1 text-center">
                                        <button type="button" class="text-red-500 hover:text-red-700"
                                            onclick="this.closest('tr').remove()"><i class="fa fa-trash"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <datalist id="book-suggestions"></datalist>
                        <button type="button" onclick="addRequestRow()"
                            class="mt-3 text-sm text-primary font-medium hover:underline">
                            <i class="fa fa-plus-circle mr-1"></i> Add Another Item
                        </button>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes / Reason</label>
                        <textarea id="request-notes" class="form-input" rows="3"
                            placeholder="e.g. Preparing for summer book fair..."></textarea>
                    </div>
                </form>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end gap-3">
                <button onclick="closeRequestModal()" class="btn-secondary">Cancel</button>
                <button id="submit-request-btn" class="btn-primary">Submit to Headquarters</button>
            </div>
        </div>
    </div>

    <!-- 1. 先引入公共库 -->
    <script src="../scripts/common.js"></script>

    <!-- 2. 再引入 Layout (它定义了 window.switchPage 和 initLayout) -->
    <script src="../scripts/layout.js"></script>

    <!-- 3. 最后引入 Staff 业务逻辑 (它依赖 layout.js) -->
    <script src="../scripts/staff.js"></script>

    <!-- 4. 启动页面 -->
    <script>
        // 确保 layout.js 加载完成后再执行
        if (typeof initLayout === 'function') {
            // 参数1: 角色 'staff', 参数2: 默认页面 'dashboard'
            initLayout('staff', 'dashboard');
        } else {
            console.error('Layout script failed to load!');
        }
    </script>
</body>

</html>
